<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>‚ö° Ion Alarm Scheduler (HH:MM:SS + State)</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #ff7eb3, #65d6ce, #ffdd94);
      color: white;
      text-align: center;
      height: 100vh;
      margin: 0;
      overflow: hidden;
    }
    h1 {
      font-size: 2.5rem;
      margin-top: 20px;
      text-shadow: 0px 0px 10px black;
      animation: glow 2s infinite alternate;
    }
    @keyframes glow {
      from { text-shadow: 0 0 5px #fff, 0 0 10px #ff0080, 0 0 20px #ff0080; }
      to { text-shadow: 0 0 10px #00ffe1, 0 0 20px #00ffe1, 0 0 30px #00ffe1; }
    }
    #controls {
      margin-top: 40px;
    }
    input, button {
      font-size: 1.2rem;
      padding: 10px 15px;
      border-radius: 12px;
      border: none;
      outline: none;
      margin: 5px;
    }
    button {
      background: linear-gradient(45deg, #00c6ff, #0072ff);
      color: white;
      cursor: pointer;
      transition: transform 0.2s;
    }
    button:hover {
      transform: scale(1.1);
    }
    ul {
      margin-top: 30px;
      list-style: none;
      padding: 0;
    }
    li {
      margin: 10px 0;
      padding: 10px;
      border-radius: 10px;
      background: rgba(0, 0, 0, 0.3);
      display: flex;
      justify-content: space-between;
      align-items: center;
      animation: pulse 3s infinite;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); background: rgba(255,255,255,0.2); }
      100% { transform: scale(1); }
    }
    .deleteBtn {
      background: linear-gradient(45deg, #ff416c, #ff4b2b);
      border: none;
      padding: 5px 10px;
      border-radius: 8px;
      cursor: pointer;
      color: white;
      font-size: 1rem;
      margin-left: 5px;
    }
    .deleteBtn:hover { transform: scale(1.2); }

    .stateBtn {
      background: linear-gradient(45deg, #ffdd00, #ff9900);
      border: none;
      padding: 5px 10px;
      border-radius: 8px;
      cursor: pointer;
      color: black;
      font-size: 1rem;
      margin-left: 5px;
    }
    .stateBtn:hover { transform: scale(1.2); }
  </style>
</head>
<body>
  <h1>‚ö° Ion Mode Alarm Scheduler ‚è∞ (HH:MM:SS + State)</h1>
  <div id="controls">
    <input type="number" id="hours" min="0" max="23" placeholder="HH">
    <input type="number" id="minutes" min="0" max="59" placeholder="MM">
    <input type="number" id="seconds" min="0" max="59" placeholder="SS">
    <button onclick="addAlarm()">‚ûï Add Alarm</button>
  </div>
  
  <h2>üïí Scheduled Alarms</h2>
  <ul id="alarmList"></ul>

  <script>
    // üîπ Firebase Config
    var firebaseConfig = {
      apiKey: "wyXceByxjUTKEWKlLXrOm64YT2SpmG5OZujyTf8l",
      authDomain: "test-3e174.firebaseapp.com",
      databaseURL: "https://test-3e174-default-rtdb.firebaseio.com/",
      projectId: "test-3e174",
      storageBucket: "test-3e174.appspot.com",
      messagingSenderId: "1234567890",
      appId: "1:1234567890:web:abcdef123456"
    };
    firebase.initializeApp(firebaseConfig);
    var db = firebase.database();

    // üîπ Add alarm
    function addAlarm() {
      let hh = document.getElementById("hours").value.padStart(2,'0');
      let mm = document.getElementById("minutes").value.padStart(2,'0');
      let ss = document.getElementById("seconds").value.padStart(2,'0');
      if(hh && mm && ss){
        let time = `${hh}:${mm}:${ss}`;
        let newRef = db.ref("alarms").push();
        newRef.set({ time: time });
        // create initial state = 0
        db.ref("state/" + newRef.key).set(0);
      } else {
        alert("Enter valid HH, MM, SS!");
      }
    }

    // üîπ Delete alarm
    function deleteAlarm(id) {
      db.ref("alarms/" + id).remove();
      db.ref("state/" + id).remove();
    }

    // üîπ Reset state manually
    function resetState(id) {
      db.ref("state/" + id).set(0);
    }

    // üîπ Display alarms with state
    db.ref("alarms").on("value", function(snapshot) {
      let alarms = [];
      snapshot.forEach(function(child) {
        alarms.push({ id: child.key, time: child.val().time });
      });

      // Sort alarms HH:MM:SS
      alarms.sort((a,b)=> a.time.localeCompare(b.time));

      let list = document.getElementById("alarmList");
      list.innerHTML = "";

      alarms.forEach(alarm => {
        // Fetch state
        db.ref("state/" + alarm.id).once("value").then(snap => {
          let state = snap.val();
          let li = document.createElement("li");
          li.innerHTML = `‚è∞ ${alarm.time} | State: ${state == 0 ? "Active" : "Triggered"}
            <button class="deleteBtn" onclick="deleteAlarm('${alarm.id}')">‚ùå Delete</button>
            <button class="stateBtn" onclick="resetState('${alarm.id}')">üîÑ Reset</button>`;
          list.appendChild(li);
        });
      });
    });
  </script>
</body>
</html>
